"use strict";(self["webpackChunkvue3_nf0"]=self["webpackChunkvue3_nf0"]||[]).push([[252],{8252:function(e,a,t){t.r(a),t.d(a,{default:function(){return h}});t(7658);var l=t(6252),o=t(2262),r=t(2201),d=t(1348);function n(e,a){if(!e)return"";if("string"===typeof e&&(e=new Date(e)),!(e instanceof Date)||isNaN(e.getTime()))return console.warn("无效的日期:",e),"";const t={yyyy:e.getFullYear(),MM:(e.getMonth()+1).toString().padStart(2,"0"),dd:e.getDate().toString().padStart(2,"0"),HH:e.getHours().toString().padStart(2,"0"),mm:e.getMinutes().toString().padStart(2,"0"),ss:e.getSeconds().toString().padStart(2,"0")};let l=a;for(let o in t)new RegExp(`(${o})`).test(l)&&(l=l.replace(RegExp.$1,t[o]));return l}const u=e=>((0,l.dD)("data-v-e529eeca"),e=e(),(0,l.Cn)(),e),i={class:"appointment-page"},s=u((()=>(0,l._)("div",{class:"section_title"},[(0,l._)("span",null,"医生预约")],-1))),p={class:"appointment-info"};var m={__name:"appointment",setup(e){const a=(0,r.tv)(),t=(0,l.FN)()?.appContext.config.globalProperties,u=(0,o.iH)(null),m=(0,o.iH)([]),c=(0,o.iH)([{value:"咨询师账号1",label:"王医生 (心理咨询)"},{value:"咨询师账号2",label:"张医生 (精神科)"},{value:"咨询师账号3",label:"李医生 (心理治疗)"}]),g=(0,o.qj)({name:"",phone:"",doctor:"",date:"",timeSlot:"",description:""}),h={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],doctor:[{required:!0,message:"请选择咨询师",trigger:"change"}],date:[{required:!0,message:"请选择预约日期",trigger:"change"}],timeSlot:[{required:!0,message:"请选择预约时段",trigger:"change"}],description:[{required:!0,message:"请描述您的症状",trigger:"blur"}]},f=()=>{g.date="",g.timeSlot="",m.value=[]},v=()=>{t?.$http({url:"/zixunshi/list",method:"GET"}).then((e=>{e.data&&0===e.data.code&&e.data.data&&(c.value=e.data.data.map((e=>({value:e.zhanghao,label:`${e.xingming} (${e.keshi||"咨询师"})`}))))})).catch((e=>{console.error("获取咨询师列表失败:",e)}))},y=()=>{if(!g.date||!g.doctor)return void(m.value=[]);const e=n(g.date,"yyyy-MM-dd");t?.$http({url:`/zixunshiyuyue/getAvailableTimeSlots?date=${e}&zixunshizhanghao=${g.doctor}`,method:"GET"}).then((e=>{e.data&&0===e.data.code?(m.value=e.data.data||[],0===m.value.length&&d.z8.warning("该日期暂无可用预约时段")):(d.z8.error(e.data.msg||"获取可用时间段失败"),m.value=[])})).catch((e=>{console.error("获取时间段出错:",e),d.z8.error("获取可用时间段失败，请稍后重试"),m.value=[]}))},b=e=>e.getTime()<Date.now()-864e5,w=()=>{u.value.validate((e=>{if(!e)return d.z8.error("请完善表单信息"),!1;{console.log("提交表单数据:",g);const e={zixunshizhanghao:g.doctor,lianxifangshi:g.phone,yuyuezixunshijian:n(g.date,"yyyy-MM-dd"),timeSlot:g.timeSlot,yuyuebeizhu:g.description,zhanghao:localStorage.getItem("userid")||"",shouji:g.phone,sfsh:"待审核",status:"待确认"};console.log("发送到后端的数据:",e),t?.$http({url:"/zixunshiyuyue/save",method:"POST",data:e}).then((e=>{console.log("后端返回结果:",e.data),e.data&&0===e.data.code?(d.z8.success("预约成功！我们的医生会尽快与您联系"),setTimeout((()=>{a.push("/index/home")}),1500)):d.z8.error(e.data.msg||"预约失败，请稍后重试")})).catch((e=>{console.error("预约提交出错:",e),d.z8.error("预约失败，请稍后重试")}))}}))},_=()=>{u.value.resetFields(),m.value=[]};return(0,l.bv)((()=>{v()})),(e,a)=>{const t=(0,l.up)("el-alert"),o=(0,l.up)("el-input"),r=(0,l.up)("el-form-item"),d=(0,l.up)("el-option"),n=(0,l.up)("el-select"),v=(0,l.up)("el-date-picker"),S=(0,l.up)("el-button"),z=(0,l.up)("el-form"),V=(0,l.up)("el-card");return(0,l.wg)(),(0,l.iD)("div",i,[s,(0,l.Wm)(V,{class:"appointment-card"},{default:(0,l.w5)((()=>[(0,l._)("div",p,[(0,l.Wm)(t,{title:"根据您的测试结果，建议您进行专业医生诊断",type:"info",description:"我们的专业医生团队将为您提供个性化的诊断和治疗方案","show-icon":"",closable:!1})]),(0,l.Wm)(z,{model:g,rules:h,ref_key:"formRef",ref:u,"label-width":"120px",class:"appointment-form"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{label:"姓名",prop:"name"},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{modelValue:g.name,"onUpdate:modelValue":a[0]||(a[0]=e=>g.name=e),placeholder:"请输入您的姓名"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(r,{label:"联系电话",prop:"phone"},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{modelValue:g.phone,"onUpdate:modelValue":a[1]||(a[1]=e=>g.phone=e),placeholder:"请输入您的联系电话"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(r,{label:"咨询师",prop:"doctor"},{default:(0,l.w5)((()=>[(0,l.Wm)(n,{modelValue:g.doctor,"onUpdate:modelValue":a[2]||(a[2]=e=>g.doctor=e),placeholder:"请选择咨询师",style:{width:"100%"},onChange:f},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(c.value,(e=>((0,l.wg)(),(0,l.j4)(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(r,{label:"预约日期",prop:"date"},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{modelValue:g.date,"onUpdate:modelValue":a[3]||(a[3]=e=>g.date=e),type:"date",placeholder:"选择预约日期","disabled-date":b,onChange:y,style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,l.Wm)(r,{label:"预约时段",prop:"timeSlot"},{default:(0,l.w5)((()=>[(0,l.Wm)(n,{modelValue:g.timeSlot,"onUpdate:modelValue":a[4]||(a[4]=e=>g.timeSlot=e),placeholder:"请选择预约时段",style:{width:"100%"},disabled:!g.date||!g.doctor},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(m.value,(e=>((0,l.wg)(),(0,l.j4)(d,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),(0,l.Wm)(r,{label:"症状描述",prop:"description"},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{type:"textarea",modelValue:g.description,"onUpdate:modelValue":a[5]||(a[5]=e=>g.description=e),placeholder:"请简要描述您的症状或问题",rows:4},null,8,["modelValue"])])),_:1}),(0,l.Wm)(r,null,{default:(0,l.w5)((()=>[(0,l.Wm)(S,{type:"primary",onClick:w},{default:(0,l.w5)((()=>[(0,l.Uk)("提交预约")])),_:1}),(0,l.Wm)(S,{onClick:_},{default:(0,l.w5)((()=>[(0,l.Uk)("重置")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])}}},c=t(3744);const g=(0,c.Z)(m,[["__scopeId","data-v-e529eeca"]]);var h=g}}]);
//# sourceMappingURL=252.f8aa9531.js.map